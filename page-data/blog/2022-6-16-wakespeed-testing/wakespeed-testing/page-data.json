{"componentChunkName":"component---src-templates-post-js","path":"/blog/2022-6-16-wakespeed-testing/wakespeed-testing/","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"type\": \"post\",\n  \"section\": \"blog\",\n  \"categories\": [\"electrical\"],\n  \"navTitle\": null,\n  \"title\": \"24V Alternator Testing\",\n  \"author\": \"Nate\",\n  \"date\": \"2022-06-16T00:00:00.000Z\",\n  \"tags\": [\"build\", \"electrical\", \"alternator\"],\n  \"metatags\": null,\n  \"cover\": {\n    \"img\": \"cover.jpeg\"\n  },\n  \"tldr\": \"The APS alternator performs pretty close to advertised performance but requires driving or higher than nominal idle to supply power.  If you are looking for serious charge capability we'd recommend this product.\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"style\", {\n    \"className\": \"grvsc-styles\"\n  }, \"\\n  .grvsc-container {\\n    overflow: auto;\\n    position: relative;\\n    -webkit-overflow-scrolling: touch;\\n    padding-top: 1rem;\\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\\n    padding-bottom: 1rem;\\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\\n    border-radius: 8px;\\n    border-radius: var(--grvsc-border-radius, 8px);\\n    font-feature-settings: normal;\\n    line-height: 1.4;\\n  }\\n  \\n  .grvsc-code {\\n    display: table;\\n  }\\n  \\n  .grvsc-line {\\n    display: table-row;\\n    box-sizing: border-box;\\n    width: 100%;\\n    position: relative;\\n  }\\n  \\n  .grvsc-line > * {\\n    position: relative;\\n  }\\n  \\n  .grvsc-gutter-pad {\\n    display: table-cell;\\n    padding-left: 0.75rem;\\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\\n  }\\n  \\n  .grvsc-gutter {\\n    display: table-cell;\\n    -webkit-user-select: none;\\n    -moz-user-select: none;\\n    user-select: none;\\n  }\\n  \\n  .grvsc-gutter::before {\\n    content: attr(data-content);\\n  }\\n  \\n  .grvsc-source {\\n    display: table-cell;\\n    padding-left: 1.5rem;\\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\\n    padding-right: 1.5rem;\\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\\n  }\\n  \\n  .grvsc-source:empty::after {\\n    content: ' ';\\n    -webkit-user-select: none;\\n    -moz-user-select: none;\\n    user-select: none;\\n  }\\n  \\n  .grvsc-gutter + .grvsc-source {\\n    padding-left: 0.75rem;\\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\\n  }\\n  \\n  /* Line transformer styles */\\n  \\n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\\n    content: ' ';\\n    position: absolute;\\n    width: 100%;\\n  }\\n  \\n  .grvsc-line-diff-add::before {\\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\\n  }\\n  \\n  .grvsc-line-diff-del::before {\\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\\n  }\\n  \\n  .grvsc-line-number {\\n    padding: 0 2px;\\n    text-align: right;\\n    opacity: 0.7;\\n  }\\n  \\n\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"TLDR: The APS alternator performs pretty close to advertised performance but requires driving or higher than nominal idle to supply power.  If you are looking for serious charge capability we'd recommend this product.\")), mdx(\"h2\", null, \"Firmware and Settings\"), mdx(\"p\", null, \"The Wakespeed has a LOT of flexibility and thus many settings.  We highly recommend spending timing reading through the content on their \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://wakespeed.com/technical.html\"\n  }, \"technical web page\"), \" paying especial attention to the \\\"Communication and Programming Guide\\\".\"), mdx(\"p\", null, \"For optimal performance, you will need to determine some specific details for your alternator.  Thankfully Wakespeed has released an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://apps.apple.com/us/app/wakespeed/id1526101154\"\n  }, \"ios app\"), \" that will produce a base configuration file specific for the APS 185 amp alternator.  The configuration it produced for us is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/368067eca8ed6d196ff4372f0d00ff9e/ALTREG.txt\"\n  }, \"here\"), \".  We annotated the meaning of the configuration parameters, and noted required changes in this version \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/052f0f7e07a46ce4847fcb8a9cd90cd0/ALTREG-annotated.txt\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"Because we wanted our Victron system to be able to read data from the Wakespeed, we needed to upgrade its firmware to the latest beta version (2.5.0).  This version is available on their technical page.  Details about this ability can be found in this \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/victronenergy/venus/issues/779\"\n  }, \"github comment thread\"), \".\"), mdx(\"p\", null, \"We updated the Wakespeed configuration file (manually) to add a few new parameters for firmware 2.5.0 and made a few changes for our specific configuration and conservatism.  The modified configuration file is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/28aef97464dda526dde3be12f37d05e2/ALTREG-2022-6-16-v-1.0.txt\"\n  }, \"here\"), \" with annotations \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/fdd5b61c45632b54034d8d2ecd6d6dc4/ALTREG-2022-6-16-v-1.0-annotated.txt\"\n  }, \"here\"), \".  Aside from changes related to our configuration, we reduced the alternator temperature limit from 120C to 100C for conservatism.  One motivation is that this alternator is directly lugged to a 2/0 cable with an insulation rating of 105C.  Another is that for any electrical equipment, cooler operation equates to longer life.\"), mdx(\"p\", null, \"We used the Wakespeed Universal Configuration Utility (a batch file) to update the firmware and upload the initial configuration.  We're a Mac household so we used a free Windows 10 image running on VirtualBox to run the utility.  It was relatively painless (we did need to play with some USB settings to ensure the virtual machine was passed the Wakespeed USB device by default from the host machine).\"), mdx(\"h2\", null, \"Initial Light-off\"), mdx(\"p\", null, \"We started the engine and observed via our Victron system a decent charge current with RPM above base idle.  Success!  \"), mdx(\"h2\", null, \"Logging Capability\"), mdx(\"p\", null, \"We fired up our loggingPi and recorded CANBus data with the Wakespeed operating and got to decoding. Our code to log Wakespeeed data is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/natecostello/wakespeed-status\"\n  }, \"here\"), \".  The script we run for testing, which logs BMS data as well is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/natecostello/rec-bms-autotesting/blob/master/bms_test/charge_script.py\"\n  }, \"here\"), \".\"), mdx(\"h2\", null, \"Initial Findings\"), mdx(\"p\", null, \"With data inn hand we could now get a good appreciation of how the system was running.  We noticed that reported Engine RPM looked off, and we felt that the system wasn't charging as hard as expected.  \"), mdx(\"p\", null, \"Based on some \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.fordtransitusaforum.com/threads/seeking-idle-rpm-data-and-crankshaft-pulley-effective-diameter.90608/post-1187692\"\n  }, \"help from the forum\"), \" we determined that our pulley ratio parameter was incorrect.  We had assumed (and measured incorrectly) a 6.5\\\" crank pulley diameter which threw off the ratio.  Using the 6\\\" diameter from the forum feed back put our reported engine RPM right in line with expectations.\"), mdx(\"p\", null, \"We increased the \\\"normal derate\\\" parameter by 20% but did not see any change in performance.  We theorized that the system must be operating in \\\"small\\\" mode as we had not changed the \\\"small derate\\\" parameter.  We confirmed this by monitoring serial data from the Wakespeed and looking at field drive.  Upon \\\"opening the patient\\\", we found a DIP switch was placing the system in \\\"small\\\" mode.  We reduced the \\\"normal derate\\\" parameter back to the default ~62%, set the DIP switch for \\\"normal\\\" and retested.\"), mdx(\"p\", null, \"For the following tests, the vehicle was being driven normally, usually a bit of start and stop to get to the highway, followed by cruising speeds between 55-70 mph.  \"), mdx(\"p\", null, \"The tests started with a SOC around 80% and terminated after charging terminated with SOC at %100.  \"), mdx(\"p\", null, \"The measured current is that measured by the BMS into the battery.  For the tests, solar power and all switchable DC loads were secured leaving ~0.7 amps (~20 watts) of base draw for the Wakespeed, Victron Cerbo, loggingPi, router, main contactor, BMS, etc.  We also found that the field drive appears to be about 3 amps or so once the Wakespeed becomes active.  So the data shown below is likely low by about 2-3 amps.\"), mdx(\"p\", null, \"Ambient temperatures were about 85-90 F.\"), mdx(\"h3\", null, \"46% Field Drive Test\"), mdx(\"p\", null, \"Testing with in \\\"small\\\" with \\\"small derate\\\" parameter (field drive) set to 0.46 (and active) demonstrated the following performance:\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://docs.google.com/spreadsheets/d/e/2PACX-1vQTcFFKGOb9fqqtI-93NP_QmIu0zNMuipFprKYlAMI2t5KybDCVkyU3Iaa3p2g6vZ4KvjHCGU8NQ7UW/pubchart?oid=766441317&format=image\",\n    \"alt\": \"46 field drive\"\n  })), mdx(\"p\", null, \"The modified configuration file is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/c8c3af3fa1c4519aa92aa4e559d075a4/ALTREG-2022-6-20-v-1.1.txt\"\n  }, \"here\"), \" with annotations \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/fc3c2a523196732853d81af0bcf4a1f9/ALTREG-2022-6-20-v-1.1-annotated.txt\"\n  }, \"here\"), \". Raw test data is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/9c89f68492b878442f10328dd25d2a27/2022-6-21-wakespeed-min-dc-load-v1.1-charge.csv\"\n  }, \"here\"), \".\"), mdx(\"h3\", null, \"62.5% Field Drive Test\"), mdx(\"p\", null, \"Testing with the \\\"normal derate\\\" parameter (field drive) set to 0.625 demonstrated the following performance:\\n\", mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://docs.google.com/spreadsheets/d/e/2PACX-1vQTcFFKGOb9fqqtI-93NP_QmIu0zNMuipFprKYlAMI2t5KybDCVkyU3Iaa3p2g6vZ4KvjHCGU8NQ7UW/pubchart?oid=909248006&format=image\",\n    \"alt\": \"62.5 field drive\"\n  })), mdx(\"p\", null, \"The modified configuration file is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/49a520cf4d63c7972840a158019f9aab/ALTREG-2022-6-21-v-1.2.txt\"\n  }, \"here\"), \" with annotations \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/be52558247dae781f7e03b4bf2e63648/ALTREG-2022-6-21-v-1.2-annotated.txt\"\n  }, \"here\"), \".  Raw test data is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/730edced083792c7d234c1f7670c40bf/2022-6-22-wakespeed-min-dc-load-v1.2-charge.csv\"\n  }, \"here\"), \".\"), mdx(\"h3\", null, \"84.0% Field Drive Test\"), mdx(\"p\", null, \"Testing with the \\\"normal derate\\\" parameter (field drive) set to 0.84 demonstrated the following performance:\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://docs.google.com/spreadsheets/d/e/2PACX-1vQTcFFKGOb9fqqtI-93NP_QmIu0zNMuipFprKYlAMI2t5KybDCVkyU3Iaa3p2g6vZ4KvjHCGU8NQ7UW/pubchart?oid=972344222&format=image\",\n    \"alt\": \"84 field drive\"\n  })), mdx(\"p\", null, \"The modified configuration file is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/1185773fdf8dfec8818d606e70bc2100/ALTREG-2022-6-22-v-1.3.txt\"\n  }, \"here\"), \" with annotations \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/563309c8c0d33ce019aacc1774285dfe/ALTREG-2022-6-22-v-1.3-annotated.txt\"\n  }, \"here\"), \".  Raw test data is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/6d047dd7843443a61ffc6080faedac57/2022-6-23-wakespeed-min-dc-load-v1.3-charge.csv\"\n  }, \"here\"), \".\"), mdx(\"h2\", null, \"Later Findings Regarding High Voltage Cutoff Events\"), mdx(\"p\", null, \"On 2022-7-10 we observed a high voltage cutoff event upon starting the van.  The system then restarted without resetting SOC to 100% and charging resumed occured via solar limited by max voltage of 28.1.  Some cell balance occured prior to the SOC reset to 100%.  The next charging event occured on the 12th, once SOC dropped to > 40% where we have SOCH set.  No alternator charge occured.  Upon inspecting the unit it was flashing an error code corresponding to BMS notifying of cutoff.  Had to power cycle BMS to resume operation as the high voltage cutoff disable alternator charging until reset (with  present settings).\"), mdx(\"p\", null, \"Over time, cells have drifted based on limited ability to balance with the new BMS firmware.  This resulted in another high voltage cutoff event on 2022-9-28 (with no SOC reset) while driving with alternator charging.  Essentially, a single cell is hitting the high voltage threshold prior to charge being limited by the charge voltage limit (28.1V presently).\"), mdx(\"p\", null, \"To solve this problem, we've made use of the CERBO generator start/stop function of relay one.  The CERBO gates the engine run signal to the Wakespeed 500 based on battery SOC.  We've tested it successfully.  It is currently set to enable alternator charging when SOC drops below 80% and disble when SOC reaches 95%. It also disables alternator charging if it loses communication with the BMS. This should:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Eliminate high voltage cutoff events due to high alternator charge rates\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Allow more balancing to occur as solar tops off the battery at lower charge rates\")), mdx(\"h2\", null, \"Future Testing\"), mdx(\"p\", null, \"Idle thermal performance is still undetermined and will be tested in the future.  Initial testing suggest we can sustain about 4KW charge rates steady state while idling.\"), mdx(\"h2\", null, \"Timeline\"), mdx(\"p\", null, \"Note: This doesn't reflect full time effort.  Its sporadic and limited by other projects, family visits, and van availability.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Finalized Wakespeed settings, Updated Wakespeed firmware, Uploaded Wakespeed settings, Initial operation (6-16-2022)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Completed Logging Code (6-17-2022)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Identified Engine RPM discrepancy (6-20-2022)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Tested v1.1 46% field drive (6-21-2022)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Identified \\\"small\\\" mode, configured for \\\"normal\\\" mode\\\", Tested v1.2 62.5% field drive (6-22-2022)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Tested v1.3 84% field drive (6-23-2022)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Implemented CERBO gating of engine run signal to limit charge (9-29-2022)\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"24V Alternator Testing","cover":{"img":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080818","images":{"fallback":{"src":"/static/74da3702e5ab4278804b1e3b3183bcb7/925c2/cover.jpg","srcSet":"/static/74da3702e5ab4278804b1e3b3183bcb7/5bac1/cover.jpg 756w,\n/static/74da3702e5ab4278804b1e3b3183bcb7/059ce/cover.jpg 1512w,\n/static/74da3702e5ab4278804b1e3b3183bcb7/925c2/cover.jpg 3024w","sizes":"(min-width: 3024px) 3024px, 100vw"},"sources":[{"srcSet":"/static/74da3702e5ab4278804b1e3b3183bcb7/525de/cover.webp 756w,\n/static/74da3702e5ab4278804b1e3b3183bcb7/4a263/cover.webp 1512w,\n/static/74da3702e5ab4278804b1e3b3183bcb7/bbe5d/cover.webp 3024w","type":"image/webp","sizes":"(min-width: 3024px) 3024px, 100vw"}]},"width":3024,"height":2156}}}}}}},"pageContext":{"slug":"/blog/2022-6-16-wakespeed-testing/wakespeed-testing/"}},"staticQueryHashes":["2882470331","3528462622","3692595610"]}