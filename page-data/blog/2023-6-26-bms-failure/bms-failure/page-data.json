{"componentChunkName":"component---src-templates-post-js","path":"/blog/2023-6-26-bms-failure/bms-failure/","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"type\": \"post\",\n  \"section\": \"blog\",\n  \"categories\": [\"electrical\"],\n  \"navTitle\": null,\n  \"title\": \"Battery Management System Failure?\",\n  \"author\": \"Nate\",\n  \"date\": \"2023-06-26T00:00:00.000Z\",\n  \"tags\": [\"build\", \"electrical\"],\n  \"metatags\": null,\n  \"cover\": {\n    \"img\": \"cover.jpeg\"\n  },\n  \"tldr\": \"While driving the Going-to-the-Sun road in Glacier National Park, we had a complete electrical system failure.\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"style\", {\n    \"className\": \"grvsc-styles\"\n  }, \"\\n  .grvsc-container {\\n    overflow: auto;\\n    position: relative;\\n    -webkit-overflow-scrolling: touch;\\n    padding-top: 1rem;\\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\\n    padding-bottom: 1rem;\\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\\n    border-radius: 8px;\\n    border-radius: var(--grvsc-border-radius, 8px);\\n    font-feature-settings: normal;\\n    line-height: 1.4;\\n  }\\n  \\n  .grvsc-code {\\n    display: table;\\n  }\\n  \\n  .grvsc-line {\\n    display: table-row;\\n    box-sizing: border-box;\\n    width: 100%;\\n    position: relative;\\n  }\\n  \\n  .grvsc-line > * {\\n    position: relative;\\n  }\\n  \\n  .grvsc-gutter-pad {\\n    display: table-cell;\\n    padding-left: 0.75rem;\\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\\n  }\\n  \\n  .grvsc-gutter {\\n    display: table-cell;\\n    -webkit-user-select: none;\\n    -moz-user-select: none;\\n    user-select: none;\\n  }\\n  \\n  .grvsc-gutter::before {\\n    content: attr(data-content);\\n  }\\n  \\n  .grvsc-source {\\n    display: table-cell;\\n    padding-left: 1.5rem;\\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\\n    padding-right: 1.5rem;\\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\\n  }\\n  \\n  .grvsc-source:empty::after {\\n    content: ' ';\\n    -webkit-user-select: none;\\n    -moz-user-select: none;\\n    user-select: none;\\n  }\\n  \\n  .grvsc-gutter + .grvsc-source {\\n    padding-left: 0.75rem;\\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\\n  }\\n  \\n  /* Line transformer styles */\\n  \\n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\\n    content: ' ';\\n    position: absolute;\\n    width: 100%;\\n  }\\n  \\n  .grvsc-line-diff-add::before {\\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\\n  }\\n  \\n  .grvsc-line-diff-del::before {\\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\\n  }\\n  \\n  .grvsc-line-number {\\n    padding: 0 2px;\\n    text-align: right;\\n    opacity: 0.7;\\n  }\\n  \\n\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"TLDR: While driving the Going-to-the-Sun road in Glacier National Park, we had a complete electrical system failure.\")), mdx(\"h2\", null, \"Background\"), mdx(\"p\", null, \"Documentation of our BMS and system control logic is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/van/electrical/BMS_wiring_logic/REC_Q_BMS_Wiring_Logic\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"General electrical system design and schematic is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/van/electrical/electrical_overview/electrical\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"Relevant Battery Management System (BMS) parameters are as follows:\"), mdx(\"p\", null, \"BMIN 3.4\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"BVOL 3.45\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"CMAX 3.7\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"MAXH 0.25\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"CHAR 3.45\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"CHIS 0.12\"), mdx(\"p\", null, \"These parameters had been in use since March 5th, 2023.\"), mdx(\"h2\", null, \"Recent History\"), mdx(\"p\", null, \"In the preceding days we had been crossing the country on our way west. To keep our electrical system topped for the trip, we had set our state-of-charge (SOC) hysteresis resume charge at 95%. This means the system would stop charging at 100% and then discharge down to 95% before resuming any charge. We don't float our battery at all. This setting has been in use since June 13th, 2023.\"), mdx(\"p\", null, \"We started the day with an 85% charge. Because we were driving several hours that day to reach Glacier, we would hit 100% charge well before arriving after which our SOC would drift down potentially starting another charge cycle. Later review of data showed this to be the case.\"), mdx(\"p\", null, \"Upon arrival at Glacier, we opted to drive the Going-to-the-Sun road. This means a long climb in lower gears with higher than cruising RPM.\"), mdx(\"h2\", null, \"Initial Indications\"), mdx(\"p\", null, \"During a short stop traveling up the road, we noticed beeping from the Victron Cerbo. We then noticed loss of house lights, fans, and loss of our Van Area Network, or VAN for short.\"), mdx(\"h2\", null, \"Troubleshooting\"), mdx(\"p\", null, \"Upon return to our campsite, we began trouble shooting. We found the BMS had no LED's lit. Main contactor was open as expected. Cycling the on-off switch on the BMS had no effect. Battery voltage at the BMS was normal, cell voltages at the BMS were normal. Ground continuity to the BMS was normal. All BMS connections were solid. No abnormal indications were obvious other than the lack of indicating LEDs on the BMS.\"), mdx(\"p\", null, \"With no error codes available from the BMS available, and all battery voltages normal, we bypassed the BMS to provide power for the evening. With out internet connectivity at our campsite we were not able to pull any VRM logs.\"), mdx(\"p\", null, \"Later that evening we observed that 3 of 4 usb outlets installed in our van had failed.\"), mdx(\"h2\", null, \"Data Review\"), mdx(\"p\", null, \"The following day we drove to an area with a clear view of the sky, connected to the internet and downloaded the Victron Cerbo data from previous day.\"), mdx(\"p\", null, \"The raw CSV is available \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/c368f560dd860e6fc51d481cfd3b146a/Rusalka_20230626-1600_to_20230626-2059.csv\"\n  }, \"here\")), mdx(\"p\", null, \"A close look at the data showed two anomalies, at 18:34 and 19:14, that preceded the final system failure, at 22:23. Note, these times (and all timestamps in the data) are Eastern Daylight Time whereas the local time zone was Mountain Daylight Time.\"), mdx(\"h3\", null, \"Anomaly 1\"), mdx(\"p\", null, \"The initial conditions include a battery lightly discharging (\\u22483A), normal battery voltage (26.58V), SOC of 95%, and a BMS commanded Charge Current Limit (CCL) of 0A.\"), mdx(\"p\", null, \"At 18:34:14 there are indications of the BMS controlled main contactor opening. The main contactor status is indicated by low battery voltage being measured by the Solar MPPT, the Victron Multiplus, and the Wakespeed alternator controller. System DC voltage is held up above zero during this period by the Solar MPPT. During the same period, BMS battery voltage and max and min cell voltage is reported as unchanged at normal values, while BMS battery current is reported as zero. Also during this period, the Wakespeed reports 'BMS Lost'.\"), mdx(\"p\", null, \"About 6 seconds after the main contactor opens, the BMS commanded (CCL) begins to rise with the first non-zero value of 41.9A.\"), mdx(\"p\", null, \"About 30 seconds after the main contactor opens, it appears to close based on non-zero BMS reported battery current and the return Solar MPPT, Multiplus, and Wakespeed measured voltage to the BMS reported value.\"), mdx(\"p\", null, \"Charging from Solar and the Alternator proceed normally after this point until 18:42 at which point charging is secured normally. Reported min and max cell voltages are 3.43 and 3.45 respectively.\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://docs.google.com/spreadsheets/d/e/2PACX-1vSbE8er3ijHyQXG_GIT9Z76bVsXoG58xG48BhMC4GSKLDf8ZlqKubbqRVlhcdLG17Iw3TwE8wU0vDPe/pubchart?oid=451174859&format=image\",\n    \"alt\": \"anomaly 1\"\n  }), \"\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Anomaly 1\")), mdx(\"h3\", null, \"Anomaly 2\"), mdx(\"p\", null, \"The initial conditions include a battery lightly discharging (\\u22484A), normal battery voltage (26.63V), SOC of 100%, and a BMS commanded CCL of 0A.\"), mdx(\"p\", null, \"At 19:15:05 there are indications of the BMS controlled contactor opening (similar indications as anomaly 1). At the same time, there appears to be a 10 second loss of BMS communication evidenced by no BMS sourced data over this period. Around this period, the Wakespeed reports 'BMS Lost'.\"), mdx(\"p\", null, \"About 10 seconds after the contactor opening, BMS communication returns, however, the BMS reported SOC is 50%. This is indicative of BMS reset with its default starting SOC. At the same packet the BMS commands a CCL of 41.0A.\"), mdx(\"p\", null, \"About 15 seconds after the contactor opening, it appears to close based on non-zero BMS reported battery current and the return Solar MPPT, Multiplus, and Wakespeed measured voltage to the BMS reported value.\"), mdx(\"p\", null, \"Charging from Solar and the Alternator ramps in the minute that follows peaking at a logged value of \\u224880A.\"), mdx(\"p\", null, \"At 19:16:54 there is indication of the main contactor opening indicated by a high voltage being measured by the Solar MPPT (32.99V), the Victron Multiplus (33.17V), and the Wakespeed alternator controller (29.19V). At this same point in time the BMS suspends communication for \\u22485 seconds. The wakespeed locks-in a 'Fault' condition. The Multiplus (VE.Bus) warns of high DC ripple. Reported min and max cell voltages immediately before and after are 3.36V.\"), mdx(\"p\", null, \"About 30 seconds after the contactor opening the second time, it appears to close based on non-zero BMS reported battery current and the return Solar MPPT, Multiplus, and Wakespeed measured voltage to the BMS reported value.\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://docs.google.com/spreadsheets/d/e/2PACX-1vSbE8er3ijHyQXG_GIT9Z76bVsXoG58xG48BhMC4GSKLDf8ZlqKubbqRVlhcdLG17Iw3TwE8wU0vDPe/pubchart?oid=163465309&format=image\",\n    \"alt\": \"Anomaly 2\"\n  }), \"\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Anomaly 2\")), mdx(\"p\", null, \"Charging from Solar proceeds normally for for the next \\u224845 minutes.\"), mdx(\"p\", null, \"At 19:41:27 the wakespeed stops reporting data. This is coincides with our arrival at Glacier and initial parking.\"), mdx(\"p\", null, \"At 19:57:38 The wakespeed resumes reporting data and indicates an 'Off' state. It likely reset following an engine off-on cycle.\"), mdx(\"p\", null, \"At 19:58:51 the Wakespeed reports a prompt shift to 'Float', a field drive of 83%, and a current of 200.5A for 2 seconds. Simultaneously, the BMS resets its SOC from 50% to 100% and reduces the commanded CCL from 279.9A to 0A. BMS reported current is 200.6A, Min and max cells are reported to be 3.43V and 3.45V respectively (up from 3.36 before the Wakespeed transient). Note, this information is included for completeness but is not indicative of any mal operation of any components.\"), mdx(\"p\", null, \"After this period, the system discharges normally for the next several hours.\"), mdx(\"h3\", null, \"Anomaly 3\"), mdx(\"p\", null, \"The initial conditions include a battery lightly discharging (\\u22486A), normal battery voltage (26.57V), SOC of 97%, and a BMS commanded CCL of 0A.\"), mdx(\"p\", null, \"At 22:25:33 there are indications of the BMS controlled contactor opening (similar indications as anomaly 1). At the same time, there appears to be a 6 second loss of BMS communication evidenced by no BMS sourced data over this period. Around this period, the Wakespeed reports 'BMS Lost'.\"), mdx(\"p\", null, \"At 22:25:39 the BMS reports a SOC of 96% and raises the CCL to 41.9A. Indications of an open main contactor persist.\"), mdx(\"p\", null, \"Over the next \\u224840 seconds, BMS comms repeatedly drop for \\u22485-10 seconds at a time.\"), mdx(\"p\", null, \"At 22:26:15 the BMS reports a SOC of 50%.\"), mdx(\"p\", null, \"BMS comms drop for \\u224827 seconds\"), mdx(\"p\", null, \"At 22:26:43 the BMS reports data for the last time.\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://docs.google.com/spreadsheets/d/e/2PACX-1vSbE8er3ijHyQXG_GIT9Z76bVsXoG58xG48BhMC4GSKLDf8ZlqKubbqRVlhcdLG17Iw3TwE8wU0vDPe/pubchart?oid=1953508423&format=image\",\n    \"alt\": \"Anomaly 3\"\n  })), mdx(\"h2\", null, \"Conclusion\"), mdx(\"p\", null, \"Clearly the BMS is dead. The hard resets in SOC and communication drops coinciding with the contactor opening are suggestive that the BMS failure is the root cause and isn't failing as a result of some other issue. This opinion was shared by Rick, the North American BMS rep.\"), mdx(\"p\", null, \"One significant concern is the way in which it failed. The second cutoff during the second anomaly occured under fairly significant charging. This is potentially damaging to the the alternator diodes and is a primary reason to have a BMS that coordinates cutoffs with the other charging components. The resulting voltage transient as the Multiplus input capacitors were charged led to an excursion over 30V. Thankfully only the USB plugs were damaged in this case and not the fridge, freezer, fans, inverter, etc. We won't know that the alternator is intact until after the BMS is replaced.\"), mdx(\"p\", null, \"Ideally, REC, the OEM for the BMS can provide additional information regarding this failure after they review the data and potentially inspect the unit.\"), mdx(\"h2\", null, \"Installing new BMS\"), mdx(\"h2\", null, \"Random notes\"), mdx(\"p\", null, \"Firmware update issue - progress bar doesn't move.\"), mdx(\"p\", null, \"changing IP address from 192.168.2.99 to the 1.X subdomain to see if that helps it did not\"), mdx(\"p\", null, \"REC confirmed my suspicion that it was related to SD card failure mode\"), mdx(\"p\", null, \"Opened Wifi module\"), mdx(\"p\", null, \"Removed card\"), mdx(\"p\", null, \"Card not recognized by computer\"), mdx(\"p\", null, \"Took 64GB GoPro SD card and formated as MS-DOS Fat using disk utility (FAT 32)\"), mdx(\"p\", null, \"Replaced card in Wifi module\"), mdx(\"p\", null, \"Firmware updated\"), mdx(\"p\", null, \"Initially normal settings were not available. Power cycled wifi unit and full settings available.\"), mdx(\"p\", null, \"Initially wakespeed was showing idle and wasn't visible in VRM and wasn't charging. Changed the REC and Victron canbus bitrate to 250kbps, after which everything worked.\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Battery Management System Failure?","cover":{"img":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#181818","images":{"fallback":{"src":"/static/d87a54848dd6e98d7b50ecf2b9ee1bc9/5c118/cover.jpg","srcSet":"/static/d87a54848dd6e98d7b50ecf2b9ee1bc9/caa96/cover.jpg 916w,\n/static/d87a54848dd6e98d7b50ecf2b9ee1bc9/c035a/cover.jpg 1832w,\n/static/d87a54848dd6e98d7b50ecf2b9ee1bc9/5c118/cover.jpg 3664w","sizes":"(min-width: 3664px) 3664px, 100vw"},"sources":[{"srcSet":"/static/d87a54848dd6e98d7b50ecf2b9ee1bc9/f9c21/cover.webp 916w,\n/static/d87a54848dd6e98d7b50ecf2b9ee1bc9/7e1d5/cover.webp 1832w,\n/static/d87a54848dd6e98d7b50ecf2b9ee1bc9/0586d/cover.webp 3664w","type":"image/webp","sizes":"(min-width: 3664px) 3664px, 100vw"}]},"width":3664,"height":2748}}}}}}},"pageContext":{"slug":"/blog/2023-6-26-bms-failure/bms-failure/"}},"staticQueryHashes":["2882470331","3528462622","3692595610"]}